---
const modules = import.meta.glob("../../data/cars/*.json", { eager: true });
const autos = Object.values(modules).map((m) => (m as any).default ?? m);

// verkauft ausblenden
const sichtbareAutos = autos.filter((a) => a.status !== "verkauft");
---

<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Fahrzeuge</title>
  </head>

  <body style="font-family: system-ui; max-width: 1100px; margin: 40px auto; padding: 0 16px;">
    <header style="display:flex; justify-content:space-between; align-items:center; gap:16px;">
      <h1 style="margin:0;">Fahrzeuge</h1>
      <nav style="display:flex; gap:12px;">
        <a href="/">Start</a>
        <a href="/kontakt/">Kontakt</a>
      </nav>
    </header>

    <div
      style="
        margin-top: 18px;
        display:grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap:16px;
      "
    >
      {sichtbareAutos.map((auto) => (
        <a href={`/fahrzeuge/${auto.id}`} style="text-decoration:none; color:inherit;">
          <div style="border:1px solid #ddd; border-radius:12px; padding:12px;">

            {/* Vorschaubild */}
            {auto.bilder?.[0] ? (
              <div
                style="
                  aspect-ratio: 16/10;
                  background:#f2f2f2;
                  border-radius:10px;
                  overflow:hidden;
                  margin-bottom:10px;
                "
              >
                <img
                  src={auto.bilder[0]}
                  alt={auto.titel}
                  loading="lazy"
                  style="width:100%; height:100%; object-fit:cover;"
                />
              </div>
            ) : (
              <div
                style="
                  aspect-ratio: 16/10;
                  background:#f2f2f2;
                  border-radius:10px;
                  margin-bottom:10px;
                  display:flex;
                  align-items:center;
                  justify-content:center;
                  opacity:.6;
                  font-size:14px;
                "
              >
                Kein Bild
              </div>
            )}

            <h3 style="margin:0 0 6px;">{auto.titel}</h3>

            <p style="margin: 0 0 6px;">
              <b>{auto.preis.toLocaleString("de-DE")} €</b>
            </p>

            <p style="margin: 0; opacity:.85;">
              {auto.km.toLocaleString("de-DE")} km · EZ {auto.ez}
            </p>

            {auto.status === "reserviert" && (
              <div style="margin-top:10px;">
                <span
                  style="
                    display:inline-block;
                    padding:4px 8px;
                    border-radius:999px;
                    background:#fff3cd;
                    border:1px solid #ffe69c;
                    font-size:12px;
                  "
                >
                  Reserviert
                </span>
              </div>
            )}
          </div>
        </a>
      ))}
    </div>
  </body>
</html>
