---
import BaseLayout from "../../layouts/BaseLayout.astro";
import autosData from "../../data/cars.json";
import { site, telHref } from "../../config/site.js";

export function getStaticPaths() {
  const autos = Array.isArray(autosData) ? autosData : (autosData?.default ?? []);
  return autos.map((auto: any) => ({ params: { id: String(auto.id) } }));
}

const autos = Array.isArray(autosData) ? autosData : (autosData?.default ?? []);
const { id } = Astro.params;
const auto = autos.find((a: any) => String(a.id) === String(id));

const title = auto
  ? `${auto.titel} – ${site.name}`
  : `Fahrzeug nicht gefunden – ${site.name}`;

const description = auto
  ? `${auto.titel}: ${Number(auto.preis).toLocaleString("de-DE")} € · ${Number(auto.km).toLocaleString("de-DE")} km · EZ ${auto.ez}.`
  : "Dieses Fahrzeug wurde nicht gefunden.";
---

<BaseLayout title={title} description={description}>
  {!auto && (
    <section class="card" style="padding:18px;">
      <h1 class="h1">Fahrzeug nicht gefunden</h1>
      <p class="p">Der Link stimmt eventuell nicht mehr.</p>
      <a class="btn primary" href="/fahrzeuge/">Zur Übersicht</a>
    </section>
  )}

  {auto && (
    <>
      <div style="display:flex;justify-content:space-between;gap:14px;flex-wrap:wrap;align-items:flex-end;">
        <div>
          <a class="small" href="/fahrzeuge/" style="text-decoration:none;opacity:.85;">← Zurück zur Übersicht</a>
          <h1 class="h1" style="margin-top:10px;">{auto.titel}</h1>
          <div class="small" style="margin-top:8px;">
            {Number(auto.km).toLocaleString("de-DE")} km · EZ {auto.ez}
            {auto.status === "reserviert" && <span style="margin-left:10px;" class="chip">Reserviert</span>}
            {auto.status === "verkauft" && <span style="margin-left:10px;" class="chip">Verkauft</span>}
          </div>
        </div>

        <div style="text-align:right;">
          <div class="small">Preis</div>
          <div style="font-size:28px;font-weight:900;">{Number(auto.preis).toLocaleString("de-DE")} €</div>
        </div>
      </div>

      <section class="card" style="margin-top:16px;overflow:hidden;">
        {auto.bilder?.length ? (
          <div class="grid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;padding:12px;">
            {auto.bilder.map((src: string) => (
              <img
                src={src}
                alt={auto.titel}
                loading="lazy"
                decoding="async"
                style="width:100%;height:220px;object-fit:cover;border-radius:14px;border:1px solid var(--line);"
              />
            ))}
          </div>
        ) : (
          <div style="padding:16px;color:var(--muted);">Keine Bilder vorhanden.</div>
        )}
      </section>

      <section class="grid" style="margin-top:16px;grid-template-columns:1fr .9fr;align-items:start;">
        <div class="card" style="padding:16px;">
          <h2 class="h2">Fahrzeugdaten</h2>
          <ul style="line-height:1.9;margin:10px 0 0;padding-left:18px;">
            <li><b>Preis:</b> {Number(auto.preis).toLocaleString("de-DE")} €</li>
            <li><b>Kilometer:</b> {Number(auto.km).toLocaleString("de-DE")} km</li>
            <li><b>Erstzulassung:</b> {auto.ez}</li>
            <li><b>Status:</b> {auto.status}</li>
          </ul>
        </div>

        <aside class="card" style="padding:16px;">
          <h2 class="h2">Interesse?</h2>
          <p class="small" style="margin-top:8px;">
            Ruf uns an oder schreib uns über das Kontaktformular. Bitte nenne dabei die Fahrzeug-ID:
            <b> {auto.id}</b>
          </p>

          <div style="display:flex;flex-direction:column;gap:10px;margin-top:12px;">
            <a class="btn primary" href="/kontakt/">Kontaktformular öffnen</a>
            {site.phones?.[0] && <a class="btn" href={telHref(site.phones[0])}>{site.phones[0]}</a>}
            {site.phones?.[1] && <a class="btn" href={telHref(site.phones[1])}>{site.phones[1]}</a>}
          </div>
        </aside>
      </section>
    </>
  )}
</BaseLayout>
